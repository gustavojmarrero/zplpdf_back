{"version":3,"sources":["../../../../../src/modules/zpl/validation/validators/position-validator.ts"],"sourcesContent":["import {\n  IZplValidator,\n  ValidatorType,\n  ValidationIssue,\n  ValidationOptions,\n} from '../zpl-validation.types.js';\nimport { getMessages } from '../messages/error-messages.js';\n\n/**\n * Validador de posicionamiento ZPL\n * Verifica: ^FO/^FT con coordenadas validas, coordenadas negativas/grandes\n */\nexport class PositionValidator implements IZplValidator {\n  type: ValidatorType = 'position';\n\n  // Limites razonables para coordenadas (en dots, 8dpmm = 203 dpi)\n  private readonly MAX_COORD = 2000;\n\n  validate(block: string, options: ValidationOptions): ValidationIssue[] {\n    const issues: ValidationIssue[] = [];\n    const messages = getMessages(options.language);\n\n    // Validar ^FO (Field Origin) - formato: ^FOx,y o ^FOx,y,z\n    this.validateFO(block, issues, messages);\n\n    // Validar ^FT (Field Typeset) - formato: ^FTx,y o ^FTx,y,z\n    this.validateFT(block, issues, messages);\n\n    return issues;\n  }\n\n  private validateFO(\n    block: string,\n    issues: ValidationIssue[],\n    messages: ReturnType<typeof getMessages>,\n  ): void {\n    // Patron para capturar ^FO con o sin coordenadas\n    const foPattern = /\\^FO(-?\\d+)?(?:,(-?\\d+))?/g;\n    let match;\n\n    while ((match = foPattern.exec(block)) !== null) {\n      const fullMatch = match[0];\n      const x = match[1];\n      const y = match[2];\n\n      // Verificar que tiene coordenadas\n      if (x === undefined || y === undefined) {\n        issues.push({\n          code: 'ZPL_POS_001',\n          type: this.type,\n          severity: 'error',\n          message: messages.foMissingCoords,\n          position: match.index,\n          context: fullMatch,\n          suggestion: messages.suggestFoFormat,\n          command: '^FO',\n        });\n        continue;\n      }\n\n      const xNum = parseInt(x, 10);\n      const yNum = parseInt(y, 10);\n\n      // Verificar coordenadas negativas\n      if (xNum < 0 || yNum < 0) {\n        issues.push({\n          code: 'ZPL_POS_002',\n          type: this.type,\n          severity: 'warning',\n          message: messages.negativeCoords,\n          position: match.index,\n          context: fullMatch,\n          suggestion: messages.suggestPositiveCoords,\n          command: '^FO',\n        });\n      }\n\n      // Verificar coordenadas excesivas\n      if (xNum > this.MAX_COORD || yNum > this.MAX_COORD) {\n        issues.push({\n          code: 'ZPL_POS_003',\n          type: this.type,\n          severity: 'warning',\n          message: messages.largeCoords,\n          position: match.index,\n          context: fullMatch,\n          suggestion: messages.suggestCheckLabelSize,\n          command: '^FO',\n        });\n      }\n    }\n  }\n\n  private validateFT(\n    block: string,\n    issues: ValidationIssue[],\n    messages: ReturnType<typeof getMessages>,\n  ): void {\n    // Patron para capturar ^FT con o sin coordenadas\n    const ftPattern = /\\^FT(\\d+)?(?:,(\\d+))?/g;\n    let match;\n\n    while ((match = ftPattern.exec(block)) !== null) {\n      const fullMatch = match[0];\n      const x = match[1];\n      const y = match[2];\n\n      // ^FT requiere coordenadas\n      if (x === undefined || y === undefined) {\n        issues.push({\n          code: 'ZPL_POS_004',\n          type: this.type,\n          severity: 'error',\n          message: messages.ftMissingCoords,\n          position: match.index,\n          context: fullMatch,\n          suggestion: messages.suggestFtFormat,\n          command: '^FT',\n        });\n        continue;\n      }\n\n      const xNum = parseInt(x, 10);\n      const yNum = parseInt(y, 10);\n\n      // Verificar coordenadas excesivas\n      if (xNum > this.MAX_COORD || yNum > this.MAX_COORD) {\n        issues.push({\n          code: 'ZPL_POS_003',\n          type: this.type,\n          severity: 'warning',\n          message: messages.largeCoords,\n          position: match.index,\n          context: fullMatch,\n          suggestion: messages.suggestCheckLabelSize,\n          command: '^FT',\n        });\n      }\n    }\n  }\n}\n"],"names":["getMessages","PositionValidator","validate","block","options","issues","messages","language","validateFO","validateFT","foPattern","match","exec","fullMatch","x","y","undefined","push","code","type","severity","message","foMissingCoords","position","index","context","suggestion","suggestFoFormat","command","xNum","parseInt","yNum","negativeCoords","suggestPositiveCoords","MAX_COORD","largeCoords","suggestCheckLabelSize","ftPattern","ftMissingCoords","suggestFtFormat"],"mappings":"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"}