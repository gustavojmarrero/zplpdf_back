{"version":3,"sources":["../../../../../src/modules/zpl/validation/validators/structure-validator.ts"],"sourcesContent":["import {\n  IZplValidator,\n  ValidatorType,\n  ValidationIssue,\n  ValidationOptions,\n} from '../zpl-validation.types.js';\nimport { getMessages } from '../messages/error-messages.js';\n\n/**\n * Validador de estructura ZPL\n * Verifica: ^XA/^XZ presentes, multiples ^XA/^XZ en un bloque\n */\nexport class StructureValidator implements IZplValidator {\n  type: ValidatorType = 'structure';\n\n  validate(block: string, options: ValidationOptions): ValidationIssue[] {\n    const issues: ValidationIssue[] = [];\n    const messages = getMessages(options.language);\n    const trimmedBlock = block.trim();\n\n    // Verificar ^XA al inicio\n    if (!trimmedBlock.startsWith('^XA')) {\n      issues.push({\n        code: 'ZPL_STRUCT_001',\n        type: this.type,\n        severity: 'error',\n        message: messages.missingXA,\n        position: 0,\n        suggestion: messages.suggestXA,\n        command: '^XA',\n      });\n    }\n\n    // Verificar ^XZ al final\n    if (!trimmedBlock.endsWith('^XZ')) {\n      issues.push({\n        code: 'ZPL_STRUCT_002',\n        type: this.type,\n        severity: 'error',\n        message: messages.missingXZ,\n        position: block.length,\n        suggestion: messages.suggestXZ,\n        command: '^XZ',\n      });\n    }\n\n    // Verificar multiples ^XA dentro del bloque\n    const xaMatches = block.match(/\\^XA/g) || [];\n    if (xaMatches.length > 1) {\n      issues.push({\n        code: 'ZPL_STRUCT_003',\n        type: this.type,\n        severity: 'error',\n        message: messages.multipleXA,\n        suggestion: messages.suggestSplitBlocks,\n        command: '^XA',\n      });\n    }\n\n    // Verificar multiples ^XZ dentro del bloque\n    const xzMatches = block.match(/\\^XZ/g) || [];\n    if (xzMatches.length > 1) {\n      issues.push({\n        code: 'ZPL_STRUCT_004',\n        type: this.type,\n        severity: 'error',\n        message: messages.multipleXZ,\n        suggestion: messages.suggestSplitBlocks,\n        command: '^XZ',\n      });\n    }\n\n    return issues;\n  }\n}\n"],"names":["getMessages","StructureValidator","validate","block","options","issues","messages","language","trimmedBlock","trim","startsWith","push","code","type","severity","message","missingXA","position","suggestion","suggestXA","command","endsWith","missingXZ","length","suggestXZ","xaMatches","match","multipleXA","suggestSplitBlocks","xzMatches","multipleXZ"],"mappings":"AAMA,SAASA,WAAW,QAAQ,gCAAgC;AAE5D;;;CAGC,GACD,OAAO,MAAMC;IAGXC,SAASC,KAAa,EAAEC,OAA0B,EAAqB;QACrE,MAAMC,SAA4B,EAAE;QACpC,MAAMC,WAAWN,YAAYI,QAAQG,QAAQ;QAC7C,MAAMC,eAAeL,MAAMM,IAAI;QAE/B,0BAA0B;QAC1B,IAAI,CAACD,aAAaE,UAAU,CAAC,QAAQ;YACnCL,OAAOM,IAAI,CAAC;gBACVC,MAAM;gBACNC,MAAM,IAAI,CAACA,IAAI;gBACfC,UAAU;gBACVC,SAAST,SAASU,SAAS;gBAC3BC,UAAU;gBACVC,YAAYZ,SAASa,SAAS;gBAC9BC,SAAS;YACX;QACF;QAEA,yBAAyB;QACzB,IAAI,CAACZ,aAAaa,QAAQ,CAAC,QAAQ;YACjChB,OAAOM,IAAI,CAAC;gBACVC,MAAM;gBACNC,MAAM,IAAI,CAACA,IAAI;gBACfC,UAAU;gBACVC,SAAST,SAASgB,SAAS;gBAC3BL,UAAUd,MAAMoB,MAAM;gBACtBL,YAAYZ,SAASkB,SAAS;gBAC9BJ,SAAS;YACX;QACF;QAEA,4CAA4C;QAC5C,MAAMK,YAAYtB,MAAMuB,KAAK,CAAC,YAAY,EAAE;QAC5C,IAAID,UAAUF,MAAM,GAAG,GAAG;YACxBlB,OAAOM,IAAI,CAAC;gBACVC,MAAM;gBACNC,MAAM,IAAI,CAACA,IAAI;gBACfC,UAAU;gBACVC,SAAST,SAASqB,UAAU;gBAC5BT,YAAYZ,SAASsB,kBAAkB;gBACvCR,SAAS;YACX;QACF;QAEA,4CAA4C;QAC5C,MAAMS,YAAY1B,MAAMuB,KAAK,CAAC,YAAY,EAAE;QAC5C,IAAIG,UAAUN,MAAM,GAAG,GAAG;YACxBlB,OAAOM,IAAI,CAAC;gBACVC,MAAM;gBACNC,MAAM,IAAI,CAACA,IAAI;gBACfC,UAAU;gBACVC,SAAST,SAASwB,UAAU;gBAC5BZ,YAAYZ,SAASsB,kBAAkB;gBACvCR,SAAS;YACX;QACF;QAEA,OAAOf;IACT;;aA5DAQ,OAAsB;;AA6DxB"}