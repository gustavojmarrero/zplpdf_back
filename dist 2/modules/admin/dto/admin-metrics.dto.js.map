{"version":3,"sources":["../../../../src/modules/admin/dto/admin-metrics.dto.ts"],"sourcesContent":["import { ApiProperty } from '@nestjs/swagger';\n\nclass RecentRegistrationDto {\n  @ApiProperty()\n  id: string;\n\n  @ApiProperty()\n  email: string;\n\n  @ApiProperty({ required: false })\n  displayName?: string;\n\n  @ApiProperty()\n  plan: string;\n\n  @ApiProperty()\n  createdAt: Date;\n}\n\nclass UsersMetricsDto {\n  @ApiProperty()\n  total: number;\n\n  @ApiProperty()\n  activeToday: number;\n\n  @ApiProperty()\n  activeWeek: number;\n\n  @ApiProperty()\n  activeMonth: number;\n\n  @ApiProperty()\n  byPlan: {\n    free: number;\n    pro: number;\n    enterprise: number;\n  };\n\n  @ApiProperty({ type: [RecentRegistrationDto] })\n  recentRegistrations: RecentRegistrationDto[];\n}\n\nclass ConversionTrendDto {\n  @ApiProperty()\n  date: string;\n\n  @ApiProperty()\n  count: number;\n\n  @ApiProperty()\n  labels: number;\n\n  @ApiProperty()\n  failures: number;\n}\n\nclass ConversionsMetricsDto {\n  @ApiProperty()\n  pdfsToday: number;\n\n  @ApiProperty()\n  pdfsWeek: number;\n\n  @ApiProperty()\n  pdfsMonth: number;\n\n  @ApiProperty()\n  pdfsTotal: number;\n\n  @ApiProperty()\n  labelsToday: number;\n\n  @ApiProperty()\n  labelsTotal: number;\n\n  @ApiProperty()\n  successRate: number;\n\n  @ApiProperty()\n  failureRate: number;\n\n  @ApiProperty({ type: [ConversionTrendDto] })\n  trend: ConversionTrendDto[];\n}\n\nclass ErrorContextDto {\n  @ApiProperty({ required: false })\n  line?: number;\n\n  @ApiProperty({ required: false })\n  command?: string;\n\n  @ApiProperty({ required: false })\n  input_length?: number;\n\n  @ApiProperty({ required: false })\n  label_count?: number;\n\n  @ApiProperty({ required: false })\n  elapsed_ms?: number;\n\n  @ApiProperty({ required: false })\n  service?: string;\n\n  @ApiProperty({ required: false })\n  error_code?: string;\n}\n\nclass RecentErrorDto {\n  @ApiProperty()\n  id: string;\n\n  @ApiProperty()\n  type: string;\n\n  @ApiProperty()\n  code: string;\n\n  @ApiProperty()\n  message: string;\n\n  @ApiProperty({ required: false })\n  userId?: string;\n\n  @ApiProperty({ required: false })\n  userEmail?: string;\n\n  @ApiProperty({ required: false })\n  jobId?: string;\n\n  @ApiProperty()\n  timestamp: Date;\n\n  @ApiProperty()\n  severity: string;\n\n  @ApiProperty({ type: ErrorContextDto, required: false })\n  context?: ErrorContextDto;\n}\n\nclass ErrorsMetricsDto {\n  @ApiProperty({ type: [RecentErrorDto] })\n  recentErrors: RecentErrorDto[];\n\n  @ApiProperty()\n  byType: Record<string, number>;\n\n  @ApiProperty()\n  criticalCount: number;\n}\n\nclass UserNearLimitDto {\n  @ApiProperty()\n  id: string;\n\n  @ApiProperty()\n  email: string;\n\n  @ApiProperty()\n  plan: string;\n\n  @ApiProperty()\n  pdfCount: number;\n\n  @ApiProperty()\n  pdfLimit: number;\n\n  @ApiProperty()\n  percentUsed: number;\n\n  @ApiProperty()\n  periodEnd: Date;\n}\n\nclass UserExceedingFrequentlyDto {\n  @ApiProperty()\n  id: string;\n\n  @ApiProperty()\n  email: string;\n\n  @ApiProperty()\n  plan: string;\n\n  @ApiProperty()\n  exceedCount: number;\n\n  @ApiProperty()\n  lastExceeded: Date;\n\n  @ApiProperty()\n  suggestedPlan: string;\n}\n\nclass PlanDistributionItemDto {\n  @ApiProperty()\n  users: number;\n\n  @ApiProperty()\n  percentage: number;\n}\n\nclass PlanUsageMetricsDto {\n  @ApiProperty()\n  distribution: {\n    free: PlanDistributionItemDto;\n    pro: PlanDistributionItemDto;\n    enterprise: PlanDistributionItemDto;\n  };\n\n  @ApiProperty({ type: [UserNearLimitDto] })\n  usersNearLimit: UserNearLimitDto[];\n\n  @ApiProperty({ type: [UserExceedingFrequentlyDto] })\n  usersExceedingFrequently: UserExceedingFrequentlyDto[];\n\n  @ApiProperty()\n  upgradeOpportunities: {\n    freeToProCandidates: number;\n    proToEnterpriseCandidates: number;\n  };\n}\n\nclass MetricsDataDto {\n  @ApiProperty({ type: UsersMetricsDto })\n  users: UsersMetricsDto;\n\n  @ApiProperty({ type: ConversionsMetricsDto })\n  conversions: ConversionsMetricsDto;\n\n  @ApiProperty({ type: ErrorsMetricsDto })\n  errors: ErrorsMetricsDto;\n\n  @ApiProperty({ type: PlanUsageMetricsDto })\n  planUsage: PlanUsageMetricsDto;\n}\n\nexport class AdminMetricsResponseDto {\n  @ApiProperty()\n  success: boolean;\n\n  @ApiProperty({ type: MetricsDataDto })\n  data: MetricsDataDto;\n\n  @ApiProperty()\n  generatedAt: Date;\n}\n"],"names":["ApiProperty","RecentRegistrationDto","required","UsersMetricsDto","type","ConversionTrendDto","ConversionsMetricsDto","ErrorContextDto","RecentErrorDto","ErrorsMetricsDto","UserNearLimitDto","UserExceedingFrequentlyDto","PlanDistributionItemDto","PlanUsageMetricsDto","MetricsDataDto","AdminMetricsResponseDto"],"mappings":";;;;;;;;;AAAA,SAASA,WAAW,QAAQ,kBAAkB;AAE9C,IAAA,AAAMC,wBAAN,MAAMA;AAeN;;;;;;;;;;;QARiBC,UAAU;;;;;;;;;;;;AAU3B,IAAA,AAAMC,kBAAN,MAAMA;AAsBN;;;;;;;;;;;;;;;;;;;;;;;QAFiBC,MAAM;YAACH;SAAsB;;;;AAI9C,IAAA,AAAMI,qBAAN,MAAMA;AAYN;;;;;;;;;;;;;;;;;AAEA,IAAA,AAAMC,wBAAN,MAAMA;AA2BN;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;QAFiBF,MAAM;YAACC;SAAmB;;;;AAI3C,IAAA,AAAME,kBAAN,MAAMA;AAqBN;;;QApBiBL,UAAU;;;;;;QAGVA,UAAU;;;;;;QAGVA,UAAU;;;;;;QAGVA,UAAU;;;;;;QAGVA,UAAU;;;;;;QAGVA,UAAU;;;;;;QAGVA,UAAU;;;;AAI3B,IAAA,AAAMM,iBAAN,MAAMA;AA8BN;;;;;;;;;;;;;;;;;;;QAjBiBN,UAAU;;;;;;QAGVA,UAAU;;;;;;QAGVA,UAAU;;;;;;;;;;;;;;QASVE,MAAMG;QAAiBL,UAAU;;;;AAIlD,IAAA,AAAMO,mBAAN,MAAMA;AASN;;;QARiBL,MAAM;YAACI;SAAe;;;;;;;;;;;;AAUvC,IAAA,AAAME,mBAAN,MAAMA;AAqBN;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAA,AAAMC,6BAAN,MAAMA;AAkBN;;;;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAA,AAAMC,0BAAN,MAAMA;AAMN;;;;;;;;;AAEA,IAAA,AAAMC,sBAAN,MAAMA;AAmBN;;;;;;;QAXiBT,MAAM;YAACM;SAAiB;;;;;;QAGxBN,MAAM;YAACO;SAA2B;;;;;;;;AAUnD,IAAA,AAAMG,iBAAN,MAAMA;AAYN;;;QAXiBV,MAAMD;;;;;;QAGNC,MAAME;;;;;;QAGNF,MAAMK;;;;;;QAGNL,MAAMS;;;;AAIvB,OAAO,MAAME;AASb;;;;;;;QALiBX,MAAMU"}